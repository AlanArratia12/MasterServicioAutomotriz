//- src/views/layout.pug
doctype html
html(lang="es")
  include partials/_head.pug
  body
    //- Navbar
    include partials/_navbar.pug

    //- Contenido
    .shell
      .content
        block content

    //- Bootstrap JS (necesario para dropdown del usuario)
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js")

    // ===== Script global: manejar el botón de tema =====
    script.
      (function () {
        function syncLabel() {
          var btn = document.getElementById('theme-toggle');
          if (!btn) return;
          if (document.documentElement.classList.contains('dark-theme')) {
            btn.innerHTML = '<i class="bi bi-sun-fill me-1"></i>Tema claro';
          } else {
            btn.innerHTML = '<i class="bi bi-moon-stars-fill me-1"></i>Tema oscuro';
          }
        }

        // Delegación de eventos: cualquier click en el doc que venga de #theme-toggle
        document.addEventListener('click', function (ev) {
          var btn = ev.target.closest('#theme-toggle');
          if (!btn) return;

          var root = document.documentElement;
          var isDark = root.classList.toggle('dark-theme');

          try {
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
          } catch (e) {}

          syncLabel();
        });

        // Ajustar texto al cargar
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', syncLabel);
        } else {
          syncLabel();
        }
      })();
