//- src/views/ajustes.pug
extends layout

block content
  h1 Ajustes
  p.lead Sección solo para el usuario administrador.

  // ======== TARJETA USUARIOS ========
  .card.mt-4
    .card-body
      h3.h5.mb-3 Usuarios
      p.text-muted Aquí puedes agregar y administrar usuarios del sistema.

      // ----- Formulario crear usuario -----
      form#form-user.row.g-3.mb-4
        .col-md-4
          label.form-label(for="nombre") Nombre
          input#nombre.form-control(
            type="text"
            name="nombre"
            placeholder="Nombre completo"
            required
          )
        .col-md-3
          label.form-label(for="username") Usuario
          input#username.form-control(
            type="text"
            name="username"
            placeholder="Ej. alan"
            required
          )
        .col-md-3
          label.form-label(for="password") Contraseña
          input#password.form-control(
            type="password"
            name="password"
            placeholder="Contraseña"
            required
          )
        .col-md-2
          label.form-label(for="role") Rol
          select#role.form-select(name="role" required)
            option(value="admin") Admin
            option(value="capturista") Capturista
            option(value="empleado") Empleado
            option(value="consulta") Consulta

        .col-12
          button.btn.btn-primary(type="submit")
            i.bi.bi-person-plus.me-1
            | Agregar usuario

      // ----- Tabla de usuarios -----
      if usuarios && usuarios.length
        .table-responsive
          table.table.table-sm.align-middle
            thead
              tr
                th ID
                th Nombre
                th Usuario
                th Rol
                th Acciones
            tbody
              each u in usuarios
                tr(data-id=u.id)
                  td= u.id
                  td= u.nombre
                  td= u.username
                  td
                    select.form-select.form-select-sm.sel-role
                      option(value="admin" selected=(u.role === 'admin')) Admin
                      option(value="capturista" selected=(u.role === 'capturista')) Capturista
                      option(value="empleado" selected=(u.role === 'empleado')) Empleado
                      option(value="consulta" selected=(u.role === 'consulta')) Consulta
                  td
                    button.btn.btn-sm.btn-outline-primary.btn-pass(type="button")
                      i.bi.bi-key.me-1
                      | Cambiar pass
                    button.btn.btn-sm.btn-outline-danger.btn-del(type="button")
                      i.bi.bi-trash.me-1
                      | Eliminar
      else
        p.text-muted No hay usuarios registrados (además del actual).

  // ===== MODAL CAMBIAR CONTRASEÑA =====
  .modal.fade#modalPass(tabindex="-1" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Cambiar contraseña
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Cerrar")
        .modal-body
          input#pass-user-id(type="hidden")
          .mb-3
            label.form-label(for="pass-new") Nueva contraseña
            input#pass-new.form-control(
              type="password"
              placeholder="Nueva contraseña"
            )
          .mb-3
            label.form-label(for="pass-confirm") Confirmar contraseña
            input#pass-confirm.form-control(
              type="password"
              placeholder="Confirmar contraseña"
            )
          .alert.alert-danger.d-none#pass-error
            | Las contraseñas no coinciden.
        .modal-footer
          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Cancelar
          button.btn.btn-primary#btn-save-pass(type="button") Guardar

  // ===== Script específico de esta vista =====
  script(src="/js/ajustes.js?v=1" defer)
